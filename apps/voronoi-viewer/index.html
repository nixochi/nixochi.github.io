<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Voronoi Diagram Viewer</title>
    <link rel="stylesheet" href="voronoi-styles.css?v=1.2.0">
</head>
<body>
    <!-- Options Button -->
    <button class="options-button" id="optionsBtn">options</button>

    <!-- Fullscreen voronoi viewer -->
    <voronoi-viewer id="viewer"></voronoi-viewer>
    
    <!-- Compact Controls Panel -->
    <div class="floating-panel controls-panel" id="controlsPanel" style="display: none;">
        <div class="control-group">
            <label class="control-label">display</label>
            <div class="toggle-wrapper">
                <div class="toggle active" id="edgesToggle"></div>
                <span class="toggle-label">edges</span>
            </div>
            <div class="toggle-wrapper">
                <div class="toggle active" id="sitesToggle"></div>
                <span class="toggle-label">sites</span>
            </div>
        </div>

        <div class="control-group">
            <label class="control-label">animation</label>
            <div class="toggle-wrapper">
                <div class="toggle" id="animateToggle"></div>
                <span class="toggle-label">animate</span>
            </div>
            <div class="slider-wrapper">
                <label class="slider-label">speed</label>
                <input type="range" class="slider" id="speedSlider"
                       min="0.1" max="3" step="0.1" value="1">
                <div class="slider-value" id="speedValue">1.0x</div>
            </div>
        </div>

        <div class="control-group">
            <label class="control-label">metric</label>
            <div class="slider-wrapper">
                <label class="slider-label">p value</label>
                <input type="range" class="slider" id="metricSlider"
                       min="1" max="10" step="0.1" value="2">
                <div class="slider-value" id="metricValue">L₂ (Euclidean)</div>
            </div>
            <div class="toggle-wrapper">
                <div class="toggle" id="infinityToggle"></div>
                <span class="toggle-label">L_∞</span>
            </div>
        </div>

        <div class="control-group">
            <label class="control-label">actions</label>
            <button class="action-btn" id="clearBtn">clear all</button>
            <button class="action-btn" id="randomBtn">add random</button>
            <button class="action-btn" id="gridBtn">grid</button>
        </div>
    </div>

    <script src="voronoi-viewer.js?v=1.2.0"></script>
    <script>
        const viewer = document.getElementById('viewer');
        const optionsBtn = document.getElementById('optionsBtn');
        const controlsPanel = document.getElementById('controlsPanel');
        
        let panelVisible = false;
        optionsBtn.textContent = 'options';
        
        optionsBtn.addEventListener('click', () => {
            panelVisible = !panelVisible;
            if (panelVisible) {
                controlsPanel.style.display = 'block';
                controlsPanel.offsetHeight;
                controlsPanel.classList.add('expanded');
                optionsBtn.textContent = 'close';
            } else {
                controlsPanel.classList.remove('expanded');
                setTimeout(() => {
                    if (!panelVisible) {
                        controlsPanel.style.display = 'none';
                    }
                }, 300);
                optionsBtn.textContent = 'options';
            }
        });
        
        const edgesToggle = document.getElementById('edgesToggle');
        const sitesToggle = document.getElementById('sitesToggle');
        const animateToggle = document.getElementById('animateToggle');
        const speedSlider = document.getElementById('speedSlider');
        const speedValue = document.getElementById('speedValue');
        const infinityToggle = document.getElementById('infinityToggle');
        const metricSlider = document.getElementById('metricSlider');
        const metricValue = document.getElementById('metricValue');
        const clearBtn = document.getElementById('clearBtn');
        const randomBtn = document.getElementById('randomBtn');
        const gridBtn = document.getElementById('gridBtn');

        // Setup edges toggle
        edgesToggle.addEventListener('click', () => {
            edgesToggle.classList.toggle('active');
            const isActive = edgesToggle.classList.contains('active');
            viewer.setShowEdges(isActive);
        });

        // Setup sites toggle
        sitesToggle.addEventListener('click', () => {
            sitesToggle.classList.toggle('active');
            const isActive = sitesToggle.classList.contains('active');
            viewer.setShowSites(isActive);
        });

        // Setup animation toggle
        animateToggle.addEventListener('click', () => {
            animateToggle.classList.toggle('active');
            const isActive = animateToggle.classList.contains('active');
            viewer.setAnimation(isActive);
        });

        // Setup animation speed slider
        speedSlider.addEventListener('input', () => {
            const speed = parseFloat(speedSlider.value);
            speedValue.textContent = `${speed.toFixed(1)}x`;
            viewer.setAnimationSpeed(speed);
        });

        // Metric slider
        function updateMetricDisplay() {
            const p = parseFloat(metricSlider.value);
            const isInfinity = infinityToggle.classList.contains('active');

            if (isInfinity) {
                metricValue.textContent = 'L∞ (Chebyshev)';
                viewer.setAttribute('metric-p', 'infinity');
            } else {
                if (p === 1) {
                    metricValue.textContent = 'L₁ (Manhattan)';
                } else if (p === 2) {
                    metricValue.textContent = 'L₂ (Euclidean)';
                } else {
                    metricValue.textContent = `L_${p.toFixed(1)}`;
                }
                viewer.setAttribute('metric-p', p.toString());
            }
        }

        metricSlider.addEventListener('input', (e) => {
            infinityToggle.classList.remove('active');
            updateMetricDisplay();
        });

        infinityToggle.addEventListener('click', () => {
            infinityToggle.classList.toggle('active');
            updateMetricDisplay();
        });

        // Action buttons
        clearBtn.addEventListener('click', () => {
            viewer.clearAll();
        });

        randomBtn.addEventListener('click', () => {
            viewer.addRandomPoints(5);
        });

        gridBtn.addEventListener('click', () => {
            viewer.generateGrid();
        });

        // Initial setup
        document.addEventListener('DOMContentLoaded', () => {
            metricValue.textContent = 'L₂ (Euclidean)';
        });
    </script>
</body>
</html>